---
title: "映射记录"
slug: "映射记录"
date: "2024-04-13"
created: "2024-04-13"
tags: ["OP"]
---

## 要实现通过互联网访问云主机内的 Nginx 的 8080 端口，您可以按照以下步骤进行操作：

```
配置云主机的安全组规则：
登录到您的云主机提供商的管理控制台，找到与您的云主机关联的安全组设置。确保已创建一个入站规则，允许来自公网的流量访问端口 8080。这将允许互联网上的请求到达云主机。


确定云主机的网络设置：
确定云主机是使用固定 IP 地址还是浮动 IP 地址。如果您有固定 IP，您可以跳过下一步，直接进行域名解析。如果您使用的是浮动 IP，则可能需要使用动态 DNS 服务来跟踪 IP 地址的变化。

域名解析：
将您拥有的域名指向云主机的 IP 地址。登录到您的域名注册商或 DNS 服务提供商的控制台，在域名设置中添加一个 A 记录或 CNAME 记录，将域名指向云主机的 IP 地址。

Nginx 配置：
在云主机上的 Nginx 配置文件中，确保已将监听端口设置为 8080，并配置正确的服务器块或代理设置，以便正确地响应来自该端口的请求。

防火墙配置：
如果云主机上使用了防火墙软件（如iptables），您需要允许入站流量通过 8080 端口。确保防火墙规则允许对该端口的访问。






```

## 如果您没有相关的端口映射或公网 IP 地址来直接访问云主机内的 Nginx 8080 端口，您可以考虑使用端口转发或反向代理来实现访问。

```
如果您没有相关的端口映射或公网 IP 地址来直接访问云主机内的 Nginx 8080 端口，您可以考虑使用端口转发或反向代理来实现访问。

端口转发：如果您有另一台位于公网的服务器（例如，您自己的本地服务器或云服务器），您可以设置端口转发规则，将公网服务器上的某个端口转发到云主机的 8080 端口。这样，外部用户就可以通过公网服务器上的端口访问云主机上的 Nginx 服务。具体的配置方法可能因操作系统和网络设备而异，您可以参考操作系统和网络设备的文档或咨询供应商的支持团队来了解如何设置端口转发规则。

反向代理：如果您有另一台位于公网的服务器，并且该服务器上运行着其他服务（例如，Web 服务器），您可以使用反向代理来实现访问。在公网服务器上配置一个反向代理，将公网服务器上的特定路径（例如，/nginx）映射到云主机内的 Nginx 8080 端口。这样，外部用户可以通过访问公网服务器上的特定路径来访问云主机上的 Nginx 服务。常用的反向代理软件包括 Nginx、Apache HTTP Server 和 HAProxy。

无论您选择使用端口转发还是反向代理，都需要确保公网服务器和云主机之间的网络连接正常，并且网络流量能够正确地路由到云主机。此外，确保所使用的方法符合您的安全要求，并采取适当的安全措施，例如访问控制和认证。

请注意，上述方法依赖于您拥有公网服务器或其他网络设备来实现访问。如果您没有这些设备或资源，您可能需要考虑与云主机提供商联系，了解是否提供了其他解决方案，如公网 IP 地址或负载均衡器来实现直接访问。
```

## 映射

```
在防火墙中，怎么做源nat和目的nat，怎么确定哪个是源地址和目的地址呢？

在防火墙中，源 NAT（Network Address Translation）和目的 NAT 是常用的网络地址转换技术，用于修改数据包中的源地址和目的地址。以下是关于源 NAT 和目的 NAT 的说明以及如何确定源地址和目的地址的简要解释：

源 NAT：
源 NAT 用于修改数据包的源地址。当数据包从内部网络发送到外部网络时，源 NAT 将内部网络中的源地址替换为外部网络接口的 IP 地址。这样，外部网络接收到的数据包将看到源地址是防火墙的外部 IP 地址，而不是内部网络的实际地址。


目的 NAT：
目的 NAT 用于修改数据包的目的地址。当数据包从外部网络发送到内部网络时，目的 NAT 将数据包的目的地址替换为内部网络中的特定 IP 地址。这样，数据包将被路由到内部网络的指定主机或服务器。


确定源地址和目的地址的方法取决于您的网络拓扑和特定的防火墙配置。通常，
源地址是指数据包的来源或发送方的 IP 地址，
目的地址是指数据包的目标或接收方的 IP 地址。


```

## 配置SNAT和DNAT

```
在配置源 NAT 和目的 NAT 时，请考虑以下几点：

源 NAT 配置通常发生在内部网络和外部网络之间。源 NAT 规则将内部网络的源 IP 地址替换为防火墙的外部 IP 地址。

目的 NAT 配置通常发生在外部网络和内部网络之间。目的 NAT 规则将外部网络的目标 IP 地址替换为内部网络中指定的 IP 地址。

您可以根据需要配置多个源 NAT 规则和目的 NAT 规则，以适应不同的网络服务和需求。

在设置 NAT 规则时，确保规则的顺序正确。较具体的规则应该在较通用的规则之前进行匹配。

具体的源 NAT 和目的 NAT 配置方法可能因防火墙品牌和型号而异。请参考您所使用防火墙的文档或咨询供应商的支持团队，以获取详细的配置指南和最佳实践建议。
```

## 网络故障排查

```
ping 
traceroute
show
telnet
clear 
debug
```





```
两台或者多台录音器之间创建路由，比如RIP、EIGRP、OSPF
```

## ping

验证：两个节点间IP层可达-------------表示网络层是连通的。

即源站点向目的站点发出一个ICMP echo Request报文，目的站点收到该报文后回一个ICMP Echo  Request报文。

```
-n  报文个数，缺省值为5
-t  持续地ping
-l  字节数，范围从0至65500


```

#故障案例①
#测试是连通性问题还是性能问题
#即连续发送20个报文，每个报文的超时时长为4000ms
`ping -c 20 -t 4000 ip-address`

#故障案例②使用大包ping对端进行MTU不一致故障排除

